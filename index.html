<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Formulario de Registro y D√≠as Libres</title>
  <link rel="icon" href="icons/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="icons/icon-192x192.png" />
  <link rel="apple-touch-icon" href="icons/icon-180x180.png" />
  <link rel="manifest" href="manifest.json" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    input, select, button {
      padding: 10px;
      font-size: 1em;
      border-radius: 8px;
      border: none;
    }
    input, select {
      background-color: #1e1e1e;
      color: white;
    }
    button {
      background-color: #4CAF50;
      color: white;
      transition: background 0.3s ease;
    }
    button:hover {
      background-color: #45a049;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background-color: #2e2e2e;
      padding: 20px;
      border-radius: 10px;
      width: 80%;
      max-width: 600px;
    }
    #resetDays-container input,
    #days-container input {
      margin-bottom: 10px;
      padding: 8px;
      width: 100%;
    }
    #enviandoMsg {
      display: none;
      text-align: center;
      margin-top: 10px;
      color: #ffa726;
      font-weight: bold;
      animation: fadeIn 0.4s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
  </style>
</head>
<body>
<div style="display: flex; justify-content: center; gap: 10px; margin-bottom: 20px;">
  <button type="button" onclick="showModal('resetModal')">üîÅ</button>
  <button type="button" onclick="showModal('gananciaModal')">üí∞</button>
  <button type="button" onclick="showModal('diasLibresModal')">üìÖ</button>
  <a href="https://docs.google.com/spreadsheets/d/1GlBG2lRCFEkdZc8q_igLwia8ekyRGtUT5qo8sWqLgH4/edit?usp=drive_link" target="_blank" style="text-decoration: none;">
    <button type="button" style="background-color: #4CAF50; padding: 10px; border-radius: 8px; border: none;">
      <img src="icons/google-drive.png" alt="Google Drive" style="width: 24px; height: 24px; vertical-align: middle;" />
    </button>
  </a> 
</div>

  <h1>Formulario de Registro de Jornadas y D√≠as Libres</h1>
  <p style="text-align:center; margin-top: -8px; color: #f9c74f;">Entorno DEV - prueba branch deploy v2 (2026-02-12)</p>

<!-- FORMULARIO PRINCIPAL -->
<div id="formPrincipal">
  <form id="formExtras">
    <label for="mes">Mes</label>
    <select id="mes" name="mes" required>
      <option value="Enero - 2026">Enero</option>
      <option value="Febrero - 2026">Febrero</option>
      <option value="Marzo - 2026">Marzo</option>
      <option value="Abril - 2026">Abril</option>
      <option value="Mayo - 2026">Mayo</option>
      <option value="Junio - 2026">Junio</option>
      <option value="Julio - 2026">Julio</option>
      <option value="Agosto - 2026">Agosto</option>
      <option value="Septiembre - 2026">Septiembre</option>
      <option value="Octubre - 2026">Octubre</option>
      <option value="Noviembre - 2026">Noviembre</option>
      <option value="Diciembre - 2026">Diciembre</option>
    </select>

    <label for="dia">D√≠a del evento (1-31)</label>
    <input type="number" id="dia" name="dia" min="1" max="31" required />

    <label for="evento">Evento</label>
    <input type="text" id="evento" name="evento" required />

    <label for="tarifa">Tipo de tarifa</label>
    <select id="tarifa" name="tarifa" required>
      <option value="Ninguna">Ninguna</option>
      <option value="Tec.Madrid">Tec.Madrid</option>
      <option value="Tec.Finde">Tec.Finde</option>
      <option value="Tec.Fuera">Tec.Fuera</option>
      <option value="Conductor - 400">Conductor - 400</option>
      <option value="Conductor + 400">Conductor + 400</option>
      <option value="Op.Med">Op.Med</option>
      <option value="Op.Bolo">Op.Bolo</option>
      <option value="Op. Gran Formato">Op. Gran Formato</option>
      <option value="Op.Directo">Op.Directo</option>
      <option value="Tec.Plato">Tec.Plato</option>
      <option value="Plato">Plato</option>
      <option value="JE.Bolo">JE.Bolo</option>
      <option value="JE.Gran Formato">JE.Gran Formato</option>
      <option value="JE.Directo">JE.Directo</option>
      <option value="Dia OFF">Dia OFF</option>
    </select>

    <label for="extras">Horas extras</label>
    <select id="extras" name="extras" required>
      <option value="No">No he hecho horas extras</option>
      <option value="12 - Normal - Bolo">12 - Normal - Bolo</option>
      <option value="13 - Normal - Bolo">13 - Normal - Bolo</option>
      <option value="14 - Normal - Bolo">14 - Normal - Bolo</option>
      <option value="15 - Normal - Bolo">15 - Normal - Bolo</option>
      <option value="16 - Normal - Bolo">16 - Normal - Bolo</option>
      <option value="12 - Op/JE - Bolo">12 - Op/JE - Bolo</option>
      <option value="13 - Op/JE - Bolo">13 - Op/JE - Bolo</option>
      <option value="14 - Op/JE - Bolo">14 - Op/JE - Bolo</option>
      <option value="15 - Op/JE - Bolo">15 - Op/JE - Bolo</option>
      <option value="16 - Op/JE - Bolo">16 - Op/JE - Bolo</option>
      <option value="12 - Op/JE - GF">12 - Op/JE - GF</option>
      <option value="13 - Op/JE - GF">13 - Op/JE - GF</option>
      <option value="14 - Op/JE - GF">14 - Op/JE - GF</option>
      <option value="15 - Op/JE - GF">15 - Op/JE - GF</option>
      <option value="12 - Op/JE - Directo">12 - Op/JE - Directo</option>
      <option value="13 - Op/JE - Directo">13 - Op/JE - Directo</option>
      <option value="14 - Op/JE - Directo">14 - Op/JE - Directo</option>
      <option value="12 - Normal - Directo">12 - Normal - Directo</option>
      <option value="13 - Normal - Directo">13 - Normal - Directo</option>
      <option value="14 - Normal - Directo">14 - Normal - Directo</option>
    </select>

    <!-- Media Jornada (RENOMBRADO) -->
    <label><input type="checkbox" id="mediaJornada" /> Media Jornada</label>
    <!-- Jefe + Operador (igual) -->
    <label><input type="checkbox" id="jefeOperador" /> Jefe + Operador</label>
    <!-- Doble Jornada (NUEVO) -->
    <label><input type="checkbox" id="dobleJornadaReal" /> Doble Jornada</label>

    <!-- Hidden para mantener nombres de campos en el env√≠o -->
    <input type="hidden" name="mediaJornada" id="hiddenMedia" />
    <input type="hidden" name="jefeOperador" id="hiddenJefe" />
    <input type="hidden" name="Doble jornada" id="hiddenDobleReal" />

    <button type="submit">Enviar</button>
  </form>
</div>

<!-- MODAL RESET -->
<div id="resetModal" class="modal">
  <div class="modal-content">
    <h3>Resetear D√≠as</h3>
    <label for="resetMes">Mes</label>
    <select id="resetMes" name="mes">
      <option value="Enero - 2026">Enero</option>
      <option value="Febrero - 2026">Febrero</option>
      <option value="Marzo - 2026">Marzo</option>
      <option value="Abril - 2026">Abril</option>
      <option value="Mayo - 2026">Mayo</option>
      <option value="Junio - 2026">Junio</option>
      <option value="Julio - 2026">Julio</option>
      <option value="Agosto - 2026">Agosto</option>
      <option value="Septiembre - 2026">Septiembre</option>
      <option value="Octubre - 2026">Octubre</option>
      <option value="Noviembre - 2026">Noviembre</option>
      <option value="Diciembre - 2026">Diciembre</option>
    </select>
    <div id="resetDays-container"></div>
    <button type="button" onclick="resetDays()">Resetear</button>
    <button type="button" onclick="closeModal('resetModal')">Cerrar</button>
  </div>
</div>

<!-- MODAL D√çAS LIBRES -->
<div id="diasLibresModal" class="modal">
  <div class="modal-content">
    <h3>Asignar D√≠as Libres</h3>
    <label for="mesDiasLibres">Mes</label>
    <select id="mesDiasLibres" name="mes">
      <option value="Enero - 2026">Enero</option>
      <option value="Febrero - 2026">Febrero</option>
      <option value="Marzo - 2026">Marzo</option>
      <option value="Abril - 2026">Abril</option>
      <option value="Mayo - 2026">Mayo</option>
      <option value="Junio - 2026">Junio</option>
      <option value="Julio - 2026">Julio</option>
      <option value="Agosto - 2026">Agosto</option>
      <option value="Septiembre - 2026">Septiembre</option>
      <option value="Octubre - 2026">Octubre</option>
      <option value="Noviembre - 2026">Noviembre</option>
      <option value="Diciembre - 2026">Diciembre</option>
    </select>
    <div id="days-container"></div>
    <button type="button" onclick="enviarDiasLibres()">Enviar D√≠as Libres</button>
    <button type="button" onclick="closeModal('diasLibresModal')">Cerrar</button>
  </div>
</div>

<!-- MODAL GANANCIA -->
<div id="gananciaModal" class="modal">
  <div class="modal-content">
    <h3>Consultar Ganancia</h3>
    <label for="mesGanancia">Mes</label>
    <select id="mesGanancia" name="mes">
      <option value="Enero - 2026">Enero</option>
      <option value="Febrero - 2026">Febrero</option>
      <option value="Marzo - 2026">Marzo</option>
      <option value="Abril - 2026">Abril</option>
      <option value="Mayo - 2026">Mayo</option>
      <option value="Junio - 2026">Junio</option>
      <option value="Julio - 2026">Julio</option>
      <option value="Agosto - 2026">Agosto</option>
      <option value="Septiembre - 2026">Septiembre</option>
      <option value="Octubre - 2026">Octubre</option>
      <option value="Noviembre - 2026">Noviembre</option>
      <option value="Diciembre - 2026">Diciembre</option>
    </select>
    <button type="button" onclick="consultarGanancia()">Consultar</button>
    <div id="gananciasResultado" style="margin-top: 15px; text-align: center;"></div>
    <button type="button" onclick="closeModal('gananciaModal')">Cerrar</button>
  </div>
</div>

<div id="enviandoMsg">‚è≥ Enviando datos...</div>

<script>
const scriptURL = 'https://script.google.com/macros/s/AKfycbwrgAgbS8C4TqhU5Uw-MFHAbb9moH8c9Mlnh4Rjv7XNiUNlRdYYQCap-PUTDXe9RcI/exec';

function mostrarMensajeEnviando(mostrar = true) {
  const msg = document.getElementById('enviandoMsg');
  msg.style.display = mostrar ? 'block' : 'none';
}

function showModal(id) {
  document.getElementById('formPrincipal').style.display = 'none';
  document.getElementById(id).style.display = 'flex';
  if (id === 'resetModal') generateResetFields();
  if (id === 'diasLibresModal') generateDaysFields();
}

function closeModal(id) {
  document.getElementById(id).style.display = 'none';
  document.getElementById('formPrincipal').style.display = 'block';
}

function generateResetFields() {
  const container = document.getElementById('resetDays-container');
  container.innerHTML = '';
  for (let i = 1; i <= 10; i++) {
    const input = document.createElement('input');
    input.type = 'number';
    input.placeholder = `D√≠a ${i}`;
    input.min = 1;
    input.max = 31;
    container.appendChild(input);
  }
}

function resetDays() {
  const dias = [...document.querySelectorAll('#resetDays-container input')].map(i => i.value).filter(Boolean);
  const mes = document.getElementById('resetMes').value;
  if (!dias.length) return alert('Introduce al menos un d√≠a');

  const formData = new FormData();
  formData.append('modo', 'reset');
  formData.append('mes', mes);
  formData.append('dias', dias.join(','));

  mostrarMensajeEnviando(true);
  fetch(scriptURL, { method: 'POST', body: formData })
    .then(r => r.json())
    .then(d => {
      mostrarMensajeEnviando(false);
      alert('D√≠as reseteados');
    })
    .catch(() => {
      mostrarMensajeEnviando(false);
      alert('Error al resetear');
    });
}

function generateDaysFields() {
  const container = document.getElementById('days-container');
  container.innerHTML = '';
  for (let i = 1; i <= 10; i++) {
    const input = document.createElement('input');
    input.type = 'number';
    input.placeholder = `D√≠a ${i}`;
    input.min = 1;
    input.max = 31;
    container.appendChild(input);
  }
}

function enviarDiasLibres() {
  const dias = [...document.querySelectorAll('#days-container input')].map(i => i.value).filter(Boolean);
  const mes = document.getElementById('mesDiasLibres').value;
  if (!dias.length) return alert('Introduce al menos un d√≠a libre');

  const formData = new FormData();
  formData.append('modo', 'diasLibres');
  formData.append('mes', mes);
  formData.append('dias', dias.join(','));

  mostrarMensajeEnviando(true);
  fetch(scriptURL, { method: 'POST', body: formData })
    .then(r => r.json())
    .then(d => {
      mostrarMensajeEnviando(false);
      alert('D√≠as libres asignados');
    })
    .catch(() => {
      mostrarMensajeEnviando(false);
      alert('Error al asignar d√≠as libres');
    });
}

function consultarGanancia() {
  const mes = document.getElementById('mesGanancia').value;
  const resultado = document.getElementById('gananciasResultado');
  resultado.textContent = '‚åõ Obteniendo datos...';
  const formData = new FormData();
  formData.append('modo', 'consulta');
  formData.append('mes', mes);

  fetch(scriptURL, {
    method: 'POST',
    body: formData,
  })
    .then(r => r.json())
    .then(data => {
      if (data.error) resultado.textContent = '‚ùå ' + data.error;
      else resultado.innerHTML = `üìÖ <b>${mes}</b><br>üí∞ Total: <b>${data.total}‚Ç¨</b><br>‚úÖ Real: <b>${data.real}‚Ç¨</b>`;
    })
    .catch(() => resultado.textContent = '‚ùå Error al obtener datos');
}

document.getElementById('formExtras').addEventListener('submit', function(e) {
  e.preventDefault();
  const form = this;
  const formData = new FormData(form);

  // Enviar booleans
  formData.set('mediaJornada', document.getElementById('mediaJornada').checked);
  formData.set('jefeOperador', document.getElementById('jefeOperador').checked);
  formData.set('Doble jornada', document.getElementById('dobleJornadaReal').checked);

  mostrarMensajeEnviando(true);
  fetch(scriptURL, {
    method: 'POST',
    body: formData
  })
    .then(res => res.json())
    .then(data => {
      mostrarMensajeEnviando(false);
      if (data.result === 'success') {
        alert('‚úÖ Datos enviados correctamente');
        const mesSeleccionado = form.mes.value;
        form.reset();
        form.mes.value = mesSeleccionado;
      } else if (data.error) {
        alert('‚ùå ' + data.error);
      }
    })
    .catch(() => {
      mostrarMensajeEnviando(false);
      alert('‚ùå Error al enviar los datos');
    });
});

const mesActual = new Date().getMonth();
const nombresMeses = [
  "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
  "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
];
const mesTexto = `${nombresMeses[mesActual]} - 2026`;
const selectsMes = [
  document.getElementById('mes'),
  document.getElementById('mesGanancia'),
  document.getElementById('mesDiasLibres'),
  document.getElementById('resetMes')
];
selectsMes.forEach(select => {
  if (select) {
    [...select.options].forEach(opt => {
      if (opt.value === mesTexto) opt.selected = true;
    });
  }
});
</script>
</body>
</html>
